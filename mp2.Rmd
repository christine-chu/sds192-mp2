---
title: "Mini-Project 2"
author: "Christine"
<<<<<<< HEAD
=======
=======
title: "ChineseDataNerds- miniproject 2"
author: "Yuri Furukawa"
>>>>>>> add36172004010bb18a378e675eb8bc32b66e980
>>>>>>> a3f830882ec2e6b07c7c2f6dae395ec09b631403
date: "October 31, 2017"
output: html_document
--- 


## Loading the data
```{r, include=FALSE}
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
library(tidyverse)
library(dplyr)
library(ggplot2)
```

## Initial clean up of the data 
```{r}
contributions1 <- merge(candidates, contributions, by = "cand_id") # merged the candidate dataframe and contribution dataframe by the cand_id to see the name of the candidate

house_elections1 <- rename(house_elections, cand_id = fec_id) # renamed the row 

cont_winner <- contributions1 %>%
  inner_join(house_elections1, by = "cand_id") 


new_cont <- contributions1 %>%
  select(cand_id, cand_name, cand_party_affiliation,  cand_election_yr, cand_office_state , name, transaction_amt) # there are a lot of contributions to the same representative. 

#recoding factors
data <- data %>%
  mutate( var = case_when(
    "REP" = "R",
    "DEM" = "D",
    TRUE - var))

contributions1 %>% group_by(cand_party_affiliation) %>% summarize(num_type = n()) %>% arrange(desc(num_type)) %>% head(4)

cont_winner %>%
  select(cand_id, cand_name, cand_party_affiliation, transaction_amt, ge_winner) %>%
  filter(transaction_amt > 0 ) %>%
  group_by(cand_name) %>%
  View()

party <- function(name_arg) {
  cont_winner %>%
    filter(cand_party_affiliation == name_arg) %>%
    filter(ge_winner == "W") %>%
    select(transaction_amt, ge_winner) %>%
    group_by(transaction_amt, ge_winner) %>%
    summarise(trans = sum(transaction_amt), win = n()) %>%
    arrange(desc(transaction_amt))
}

party2 <- function(name_arg) {
  cont_winner %>%
    filter(cand_party_affiliation == name_arg) %>%
    filter(ge_winner == "W") %>%
    group_by(transaction_amt, ge_winner) %>%
    summarise(trans = sum(transaction_amt), win = n()) %>%
    arrange(desc(transaction_amt))
}  

cont_winner %>%
  group_by(cand_party_affiliation) %>%
  summarise( nrow = n()) %>%
  arrange(desc(nrow)) %>%
  head (5)
  

```
cont_winner2 <- cont_winner %>%
  filter(cand_party_affiliation %in% c("REP", "DEM", "DFL", "UNK", "OTH"))

```

```{r message = FALSE}
party_plot_bar <- ggplot(cont_winner2, aes(x = cand_party_affiliation, y = transaction_amt, fill = ge_winner)) +
  geom_bar(position = "dodge", stat = "identity") + 
  labs( x = "Party Affiliation", y = "Transaction Amount") + 
  scale_fill_discrete(name = "Election Results") +
  scale_y_continuous(limits = c(0, 3000000
), breaks = seq(0, 3000000, 500000), expand = c(0,0)) + 
  labs(title = "Does transaction amount affect win rate?", subtitle = "Exploring the relationship between contributions and election results") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 
party_plot_bar
```

```{r}
#making a function to look at the names of the candidates #filtering the large dataframe 
look_name <- function(name_arg) {
    cont_winner %>%
    filter(cand_name == name_arg)
  }

look_name(name_arg = "ROBY, MARTHA")
```

```{r}
robymartha <- look_name(name_arg = "ROBY, MARTHA")
```


